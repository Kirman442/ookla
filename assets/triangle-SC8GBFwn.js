import{be as U,bP as g,c7 as j,cv as w,h7 as A,bC as M,h6 as N,cx as O,gW as $,c4 as q}from"./index-Bjl6Xt50.js";import{s as L}from"./ObjectStack-D9XvkZP7.js";import{v as W}from"./lineSegment-BIbUQxzN.js";import"./plane-CiTIEm-Q.js";var z;(function(i){i[i.Layer=0]="Layer",i[i.Object=1]="Object",i[i.Mesh=2]="Mesh",i[i.Line=3]="Line",i[i.Point=4]="Point",i[i.Material=5]="Material",i[i.Texture=6]="Texture",i[i.COUNT=7]="COUNT"})(z||(z={}));class T{constructor(o,m,u){this.primitiveIndices=o,this._numIndexPerPrimitive=m,this.position=u,this._children=void 0,g(o.length>=1),g(u.size===3||u.size===4);const{data:s,size:l,indices:p}=u;g(p.length%this._numIndexPerPrimitive==0),g(p.length>=o.length*this._numIndexPerPrimitive);const I=o.length;let e=l*p[this._numIndexPerPrimitive*o[0]];x.clear(),x.push(e);const n=j(s[e],s[e+1],s[e+2]),t=w(n);for(let a=0;a<I;++a){const d=this._numIndexPerPrimitive*o[a];for(let c=0;c<this._numIndexPerPrimitive;++c){e=l*p[d+c],x.push(e);let h=s[e];n[0]=Math.min(h,n[0]),t[0]=Math.max(h,t[0]),h=s[e+1],n[1]=Math.min(h,n[1]),t[1]=Math.max(h,t[1]),h=s[e+2],n[2]=Math.min(h,n[2]),t[2]=Math.max(h,t[2])}}this.bbMin=n,this.bbMax=t;const r=A(M(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(t[0]-n[0],t[1]-n[1]),t[2]-n[2]);let f=this.radius*this.radius;for(let a=0;a<x.length;++a){e=x.at(a);const d=s[e]-r[0],c=s[e+1]-r[1],h=s[e+2]-r[2],P=d*d+c*c+h*h;if(P<=f)continue;const v=Math.sqrt(P),_=.5*(v-this.radius);this.radius=this.radius+_,f=this.radius*this.radius;const b=_/v;r[0]+=d*b,r[1]+=c*b,r[2]+=h*b}this.center=r,x.clear()}getChildren(){if(this._children||N(this.bbMin,this.bbMax)<=1)return this._children;const o=A(M(),this.bbMin,this.bbMax,.5),m=this.primitiveIndices.length,u=new Uint8Array(m),s=new Array(8);for(let t=0;t<8;++t)s[t]=0;const{data:l,size:p,indices:I}=this.position;for(let t=0;t<m;++t){let r=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[t];let a=p*I[f],d=l[a],c=l[a+1],h=l[a+2];for(let P=1;P<this._numIndexPerPrimitive;++P){a=p*I[f+P];const v=l[a],_=l[a+1],b=l[a+2];v<d&&(d=v),_<c&&(c=_),b<h&&(h=b)}d<o[0]&&(r|=1),c<o[1]&&(r|=2),h<o[2]&&(r|=4),u[t]=r,++s[r]}let e=0;for(let t=0;t<8;++t)s[t]>0&&++e;if(e<2)return;const n=new Array(8);for(let t=0;t<8;++t)n[t]=s[t]>0?new Uint32Array(s[t]):void 0;for(let t=0;t<8;++t)s[t]=0;for(let t=0;t<m;++t){const r=u[t];n[r][s[r]++]=this.primitiveIndices[t]}this._children=new Array;for(let t=0;t<8;++t)n[t]!==void 0&&this._children.push(new T(n[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){x.prune()}}const x=new U({deallocator:null});function k(i){return i?{p0:w(i.p0),p1:w(i.p1),p2:w(i.p2)}:{p0:M(),p1:M(),p2:M()}}function G(i,o,m){return O(y,o,i),O(C,m,i),.5*$(q(y,y,C))}new L(W);new L(()=>k());const y=M(),C=M();export{G as d,z as e,T as o};
